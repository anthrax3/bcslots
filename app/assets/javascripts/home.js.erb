$(function() {

  var flashvars = {
    config_file: "<%= asset_path 'slot_machine_config.xml' %>"
  };

  var params = {
    align: "default",
    wmode: "transparent",
    menu: "false",
    scale: "noscale"
  };

  var attributes = {
    id: "swf_content",
    name: "swf_content"
  };

  pollForBalanceChange = function(balance) {
    if (balance  === 0) {
      $.get('/balance/<%= 'a' %>', function(data) { 
        if (swf_content.setToNewBalance === undefined || data.balance_in_mBTC === '0') {
          setTimeout(function() { pollForBalanceChange(0); }, 1000);
        }
        else {
          swf_content.setToNewBalance(data);
        }
      });
    }
  };

  pollForBalanceChange(balance_in_mBTC());
  window.swfobject.embedSWF("<%= asset_path 'slot_machine.swf' %>", "flashcontent", "100%", "100%", "8.0.0", false, flashvars, params, attributes);
});
